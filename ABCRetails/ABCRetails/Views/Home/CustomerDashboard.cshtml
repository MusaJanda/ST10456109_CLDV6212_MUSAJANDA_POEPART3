@model ABCRetails.Models.ViewModels.CustomerDashboardViewModel
@{
    ViewData["Title"] = "Customer Dashboard";
}

<style>
    .dashboard-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
    }

    .welcome-section {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border-radius: 20px;
        padding: 3rem 2rem;
        color: white;
        margin-bottom: 2rem;
        text-align: center;
        border: 1px solid var(--border-color);
        box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
    }

        .welcome-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .welcome-section p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
    }

    .stat-card {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 2rem;
        border: 1px solid var(--border-color);
        text-align: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(99, 102, 241, 0.2);
            border-color: var(--primary-color);
        }

            .stat-card:hover::before {
                transform: scaleX(1);
            }

        .stat-card .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-card .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-card .stat-label {
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 1rem;
        }

    .shopping-section {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 2rem;
        border: 1px solid var(--border-color);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .cart-items {
        margin-bottom: 1.5rem;
        max-height: 400px;
        overflow-y: auto;
    }

    .cart-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: rgba(99, 102, 241, 0.05);
        border-radius: 12px;
        margin-bottom: 0.5rem;
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
    }

        .cart-item:hover {
            background: rgba(99, 102, 241, 0.1);
        }

    .cart-item-info {
        flex: 1;
    }

    .cart-item-name {
        color: var(--text-primary);
        font-weight: 600;
        margin-bottom: 0.25rem;
    }

    .cart-item-price {
        color: var(--text-secondary);
        font-size: 0.875rem;
    }

    .cart-item-quantity {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 0.5rem 0;
    }

    .quantity-btn {
        background: rgba(99, 102, 241, 0.2);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        color: var(--text-primary);
    }

        .quantity-btn:hover {
            background: var(--primary-color);
            color: white;
        }

    .quantity-display {
        color: var(--text-primary);
        font-weight: 600;
        min-width: 30px;
        text-align: center;
    }

    .cart-item-actions {
        margin-left: 1rem;
    }

    .cart-total {
        text-align: center;
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 1.5rem;
        padding: 1rem;
        background: rgba(99, 102, 241, 0.1);
        border-radius: 12px;
        border: 1px solid var(--border-color);
    }

    .checkout-btn {
        background: linear-gradient(135deg, var(--accent-color), #059669);
        border: none;
        border-radius: 12px;
        padding: 1rem 2rem;
        color: white;
        font-weight: 600;
        width: 100%;
        transition: all 0.3s ease;
        cursor: pointer;
        font-size: 1.1rem;
    }

        .checkout-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(16, 185, 129, 0.4);
        }

        .checkout-btn:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

    .empty-state {
        text-align: center;
        padding: 3rem 2rem;
        color: var(--text-secondary);
    }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

    .btn-outline-danger {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #ef4444;
        border-radius: 8px;
        padding: 0.5rem;
        transition: all 0.3s ease;
        cursor: pointer;
    }

        .btn-outline-danger:hover {
            background: #ef4444;
            border-color: #ef4444;
            color: white;
        }

    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--accent-color);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #ef4444;
        }
</style>

<div class="dashboard-container">
    <!-- Welcome Section -->
    <div class="welcome-section">
        <h1><i class="fas fa-user-circle me-2"></i>Welcome Back, @Model.CustomerName!</h1>
        <p>Ready to shop? Browse our amazing products below!</p>
    </div>

    <!-- Stats Section -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="stat-number" id="cartItemCount">0</div>
            <div class="stat-label">Items in Cart</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-box"></i>
            </div>
            <div class="stat-number">@Model.OrderCount</div>
            <div class="stat-label">Total Orders</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-number">@Model.PendingOrders</div>
            <div class="stat-label">Pending Orders</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-rand-sign"></i>
            </div>
            <div class="stat-number">@Model.TotalSpent.ToString("C")</div>
            <div class="stat-label">Total Spent</div>
        </div>
    </div>

    <!-- Shopping Cart Section -->
    <div class="shopping-section">
        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-shopping-cart me-2"></i>My Shopping Cart</h2>
        </div>

        <div class="cart-items" id="cartItems">
            <!-- Cart items will be populated by JavaScript -->
        </div>

        <div class="cart-total" id="cartTotal">
            Total: $0.00
        </div>

        <button class="checkout-btn" id="checkoutBtn" disabled>
            <i class="fas fa-credit-card me-2"></i>Proceed to Checkout
        </button>
    </div>
</div>

<!-- Notification Element -->
<div class="notification" id="notification" style="display: none;">
    <i class="fas fa-check-circle me-2"></i>
    <span id="notificationMessage"></span>
</div>

@section Scripts {
    <script>
        // Cart management functions
        let cart = JSON.parse(localStorage.getItem('customerCart')) || [];

        function updateCartDisplay() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            const checkoutBtn = document.getElementById('checkoutBtn');
            const cartItemCount = document.getElementById('cartItemCount');

            // Update cart count in stats
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartItemCount.textContent = totalItems;

            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-shopping-cart fa-2x"></i>
                        <h3>Your cart is empty</h3>
                        <p>Add some products to get started!</p>
                    </div>
                `;
                cartTotal.textContent = 'Total: $0.00';
                checkoutBtn.disabled = true;
                return;
            }

            let total = 0;
            cartItems.innerHTML = cart.map(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                return `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price">$${item.price.toFixed(2)} each</div>
                            <div class="cart-item-quantity">
                                <button class="quantity-btn decrease-quantity" data-product-id="${item.id}">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span class="quantity-display">${item.quantity}</span>
                                <button class="quantity-btn increase-quantity" data-product-id="${item.id}">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="cart-item-actions">
                            <button class="btn-outline-danger remove-from-cart" data-product-id="${item.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            cartTotal.textContent = `Total: $${total.toFixed(2)}`;
            checkoutBtn.disabled = false;

            // Add event listeners to cart action buttons
            document.querySelectorAll('.remove-from-cart').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = e.target.closest('button').getAttribute('data-product-id');
                    removeFromCart(productId);
                });
            });

            document.querySelectorAll('.decrease-quantity').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = e.target.closest('button').getAttribute('data-product-id');
                    updateQuantity(productId, -1);
                });
            });

            document.querySelectorAll('.increase-quantity').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = e.target.closest('button').getAttribute('data-product-id');
                    updateQuantity(productId, 1);
                });
            });
        }

        function addToCart(productId, productName, productPrice) {
            const existingItem = cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: productName,
                    price: parseFloat(productPrice),
                    quantity: 1
                });
            }

            localStorage.setItem('customerCart', JSON.stringify(cart));
            updateCartDisplay();
            showNotification(`${productName} added to cart!`);

            // Visual feedback on the button
            const button = document.querySelector(`[data-product-id="${productId}"]`);
            if (button) {
                button.classList.add('added');
                button.innerHTML = '<i class="fas fa-check me-2"></i>Added to Cart';
                setTimeout(() => {
                    button.classList.remove('added');
                    button.innerHTML = '<i class="fas fa-cart-plus me-2"></i>Add to Cart';
                }, 2000);
            }
        }

        function removeFromCart(productId) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                cart = cart.filter(item => item.id !== productId);
                localStorage.setItem('customerCart', JSON.stringify(cart));
                updateCartDisplay();
                showNotification(`${item.name} removed from cart!`, 'error');
            }
        }

        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;

                // Remove item if quantity becomes 0 or less
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                    return;
                }

                localStorage.setItem('customerCart', JSON.stringify(cart));
                updateCartDisplay();
            }
        }

        function checkout() {
            if (cart.length === 0) {
                showNotification('Your cart is empty!', 'error');
                return;
            }

            // Redirect to order creation with cart data
            const cartData = encodeURIComponent(JSON.stringify(cart));
            window.location.href = `/Order/Create?cart=${cartData}`;
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationMessage = document.getElementById('notificationMessage');

            notificationMessage.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'flex';
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 300);
            }, 3000);
        }

        // Initialize cart functionality
        document.addEventListener('DOMContentLoaded', function() {
            updateCartDisplay();

            // Add event listeners to all "Add to Cart" buttons
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    if (button.disabled) return;

                    const productId = button.getAttribute('data-product-id');
                    const productName = button.getAttribute('data-product-name');
                    const productPrice = button.getAttribute('data-product-price');
                    addToCart(productId, productName, productPrice);
                });
            });

            // Checkout button event listener
            document.getElementById('checkoutBtn').addEventListener('click', checkout);

            // Debug: Log cart state
            console.log('Cart initialized:', cart);
        });
    </script>
}